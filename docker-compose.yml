version: '3.7'

services:

  mongodb:
    image: mongo:3.6
    container_name: mongodb_dodgeball
    restart: unless-stopped
    volumes:
      - mongodb-dodgeball-storage:/var/lib/mongodb
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root
    ports:
      - "27017:27017"
    networks:
      - dodgeball-network

  mysql:
    image: mysql
    container_name: mysql_dodgeball
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_ROOT_HOST: "%"
    ports:
      - '3306:3306'
    volumes:
      - mysql-dodgeball-storage:/var/lib/mysql
    networks:
      - dodgeball-network

  dodgeball_web:
    image: tolfx/dodgeball-web:latest
    container_name: dodgeball_web
    restart: unless-stopped
    ports:
      - "3000:3000"
    networks:
      - dodgeball-network

  dodgeball_api:
    image: tolfx/dodgeball-api:latest
    container_name: dodgeball_api
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      MYSQL_HOST: mysql_dodgeball
      MYSQL_USER: root
      MYSQL_PASSWORD: root
      MYSQL_PORT: 3306
      MONGO_HOST: mongodb_dodgeball
      DEBUG: dodgeball*
    networks:
      - dodgeball-network

  dodgeball_micro_fetchserver:
    image: tolfx/dodgeball-fetchserver:latest
    container_name: dodgeball_micro_fetchserver
    restart: unless-stopped
    environment:
      - MONGO_HOST=mongodb_dodgeball
      - DEBUG=dodgeball*
    networks:
      - dodgeball-network

volumes:
  mongodb-dodgeball-storage:
  mysql-dodgeball-storage:


networks:
  dodgeball-network:
    driver: bridge
